# =========================
# Poster Matcher ‚Äì Config
# =========================
# U≈ºywany przez:
#   poster_matcher/poster_indexer.py
#   poster_matcher/poster_matcher.py
# Obs≈Çuguje codzienny indeks obraz√≥w (indexer)
# i dopasowywanie post√≥w z flairem Link Request (matcher).

reddit:
  # nazwa sekcji w praw.ini (w .config/praw/praw.ini lub ~/.config/praw/praw.ini)
  praw_site: "Cleanup_Bot"
  # subreddit, kt√≥ry przetwarzamy
  subreddit: "CShortDramas"

paths:
  # baza danych z hashami obraz√≥w (SQLite)
  index_db: "poster_matcher/data/poster_index.sqlite"
  # plik z ostatnim przetworzonym timestampem
  state_file: "poster_matcher/cache/state.json"
  # katalog, gdzie trafiajƒÖ raporty CSV/JSONL
  reports_dir: "poster_matcher/reports"

# --------------------------------------
# Ustawienia indeksowania (poster_indexer)
# --------------------------------------
indexing:
  # ile dni wstecz trzymamy dane w indeksie (kandydaci do por√≥wna≈Ñ)
  lookback_days: 90

  # minimalne wymiary obrazu, aby policzyƒá hash
  min_width: 320
  min_height: 320

  # maksymalny rozmiar pliku (8 MB)
  max_image_bytes: 8000000

  # maksymalny czas pobierania obrazu (sekundy)
  timeout_sec: 12

  # identyfikacja w nag≈Ç√≥wkach HTTP
  user_agent: "Cleanup_Bot PosterMatcher/1.0"

# --------------------------------------
# Pobieranie obraz√≥w ‚Äì preferencje jako≈õci
# --------------------------------------
download:
  # preferowana szeroko≈õƒá z preview.resolutions
  max_width: 1280
  # fallbackowa szeroko≈õƒá, je≈õli powy≈ºsza jest zbyt du≈ºa lub brak preview
  fallback_width: 720

# --------------------------------------
# Dopasowania (poster_matcher)
# --------------------------------------
matching:
  # ile godzin wstecz skanowaƒá nowe posty LR
  lr_window_hours: 24

  # dozwolone flairy (r√≥≈ºne wersje "Link Request")
  flair_allow:
    - "Link Request"
    - "üìå Link Request"

  # shortlist ‚Äì szybkie filtrowanie kandydat√≥w
  shortlist:
    # maksymalna liczba kandydat√≥w po shortlistingu
    max_candidates: 300
    # maksymalny dystans phash16, aby kandydat trafi≈Ç do shortlisty
    phash16_max_dist: 20
    # minimalna korelacja HSV, aby kandydat trafi≈Ç do shortlisty
    hsv_min_corr: 0.85

  # progi decyzyjne dla ≈ÇƒÖcznego wyniku ensemble
  thresholds:
    # pewne dopasowanie (CERTAIN)
    certain: 0.85
    # mo≈ºliwe dopasowanie (UNSURE)
    unsure: 0.72

  # ile najlepszych kandydat√≥w zapisaƒá w JSONL
  topk: 5

  # wagi poszczeg√≥lnych cech w ensemble score
  weights:
    phash16: 0.30
    phash8: 0.10
    dhash16: 0.15
    whash: 0.15
    center: 0.10
    hsv: 0.20
