# ========================= 
# Poster Matcher ‚Äì Config
# =========================
# U≈ºywany przez:
#   poster_matcher/poster_indexer.py      (lokalny indexer ‚Üí SQLite)
#   poster_matcher/poster_matcher.py      (lokalny matcher)
#   poster_matcher/gh_indexer.py          (GitHub Actions ‚Üí shardy JSONL)
# GH indexer zapisuje do: data/shards/YYYY-MM-DD.jsonl

reddit:
  # nazwa sekcji w praw.ini (w runnerze generujemy z Secrets jako [Cleanup_Bot], lokalnie tak samo)
  praw_site: "Cleanup_Bot"
  # subreddit do przetwarzania
  subreddit: "CShortDramas"

paths:
  # baza hashy (SQLite) ‚Äì u≈ºywana tylko lokalnie
  index_db: "poster_matcher/data/poster_index.sqlite"
  # stan lokalny (ostatni indexed_utc) ‚Äì u≈ºywany tylko lokalnie
  state_file: "poster_matcher/cache/state.json"
  # raporty lokalne (CSV/JSONL z matchera)
  reports_dir: "poster_matcher/reports"
  # docelowe miejsce shard√≥w w repo (informacyjnie; GH indexer i tak u≈ºywa data/shards/)
  shards_dir: "data/shards"

# --------------------------------------
# Ustawienia indeksowania (pobieranie obraz√≥w & limity)
# --------------------------------------
indexing:
  # ile dni wstecz trzymamy dane do por√≥wna≈Ñ (dla LOCAL matchera); GH indexer nie u≈ºywa
  lookback_days: 90

  # minimalne wymiary obrazu, aby policzyƒá hash
  min_width: 320
  min_height: 320

  # maksymalny rozmiar pliku (bajt√≥w)
  max_image_bytes: 8000000  # 8 MB

  # maksymalny czas pobierania obrazka (sek.)
  timeout_sec: 15

  # identyfikacja w nag≈Ç√≥wkach HTTP
  user_agent: "Cleanup_Bot PosterMatcher/1.0"

# --------------------------------------
# Pobieranie obraz√≥w ‚Äì preferencje jako≈õci
# --------------------------------------
download:
  # preferowana szeroko≈õƒá z preview.resolutions
  max_width: 1280
  # fallbackowa szeroko≈õƒá, je≈õli powy≈ºsza jest zbyt du≈ºa lub brak preview
  fallback_width: 720
  # BLOKADA host√≥w, z kt√≥rych nie pobieramy obraz√≥w (linki do stron/video)
  block_hosts:
    - facebook.com
    - www.facebook.com
    - m.facebook.com
    - l.facebook.com
    - web.facebook.com
    - youtube.com
    - youtu.be
    - tiktok.com
    - www.tiktok.com
    - instagram.com
    - www.instagram.com
    - x.com
    - twitter.com
    - mobile.twitter.com

# --------------------------------------
# Dopasowania (u≈ºywane przez lokalny poster_matcher.py)
# --------------------------------------
matching:
  # ile godzin wstecz skanowaƒá nowe posty LR
  lr_window_hours: 24

  # dozwolone flairy (r√≥≈ºne wersje "Link Request")
  flair_allow:
    - "Link Request"
    - "üìå Link Request"

  # shortlist ‚Äì szybkie filtrowanie kandydat√≥w
  shortlist:
    max_candidates: 300
    phash16_max_dist: 20
    hsv_min_corr: 0.85

  # progi decyzyjne dla ≈ÇƒÖcznego wyniku ensemble
  thresholds:
    certain: 0.85   # pewne dopasowanie
    unsure: 0.72    # mo≈ºliwe dopasowanie

  # ile najlepszych kandydat√≥w zapisaƒá w JSONL
  topk: 5

  # wagi poszczeg√≥lnych cech w ensemble score
  weights:
    phash16: 0.30
    phash8: 0.10
    dhash16: 0.15
    whash:   0.15
    center:  0.10
    hsv:     0.20
